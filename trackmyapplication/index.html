
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job/Application Tracker - Full Upgrade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .active-btn {
            background-color: #3b82f6;
            color: white;
        }

        button {
            padding: 0.5rem 1rem; /* Adjusted padding for better fit */
            margin-right: 0.5rem; /* Adjusted margin */
            font-size: 0.875rem; /* Slightly smaller font for more buttons */
            border-radius: 0.375rem; /* Standard tailwind rounded-md */
        }
        #status {
            margin-top: 1rem;
            font-weight: bold;
        }

        .progress-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            margin-top: 16px;
        }

        .progress-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background-color: #d1d5db;
            transform: translateY(-50%);
            z-index: 0;
        }

        .progress-fill {
            position: absolute;
            top: 50%;
            left: 0;
            height: 4px;
            background-color: #3b82f6;
            transform: translateY(-50%);
            z-index: 1;
            transition: width 0.5s ease-in-out;
        }

        .progress-step {
            position: relative;
            z-index: 2;
            background-color: white;
            border: 2px solid #d1d5db;
            color: #6b7280;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease, transform 0.3s ease;
        }

        .progress-step.active {
            background-color: #3b82f6;
            border-color: #3b82f6;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 8px #3b82f6;
        }
        .progress-step.hold {
            background-color: #f59e0b; /* Amber 500 */
            border-color: #f59e0b;
            color: white;
        }
        .progress-step.rejected {
            background-color: #ef4444; /* Red 500 */
            border-color: #ef4444;
            color: white;
        }


        .progress-label {
            font-size: 10px;
            text-align: center;
            margin-top: 4px;
            max-width: 60px; /* Ensure labels don't stretch too much */
            overflow-wrap: break-word;
        }

        .add-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background-color: #3b82f6;
            color: white;
            font-size: 32px;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 50;
            transition: background-color 0.3s;
        }

        .add-btn:hover {
            background-color: #2563eb;
        }

        .offered-card {
            border: 4px solid #48bb78; /* Green border for offers */
        }

        .offered-row {
            background-color: #f0fff4; /* Light green background for offers */
        }

        .stage-date-tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            z-index: 10;
            bottom: -28px; /* Adjusted for better visibility */
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            display: none;
        }

        .progress-step:hover .stage-date-tooltip {
            display: block;
        }

        .copy-btn {
            background-color: #4caf50;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 5px;
        }

        .copy-btn:hover {
            background-color: #45a049;
        }

        @media (max-width: 768px) { /* Adjusted breakpoint */
            .progress-step {
                width: 28px; /* Slightly larger for mobile */
                height: 28px;
                font-size: 10px;
            }

            .progress-label {
                font-size: 9px;
            }
            .action-buttons-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); /* Responsive grid for buttons */
                gap: 0.5rem;
            }
        }
         /* Tailwind Custom Form Inputs (Optional, for better aesthetics) */
        .form-input {
            @apply w-full border p-2 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500;
        }
        .btn {
            @apply px-4 py-2 rounded font-semibold shadow-md transition-colors duration-150;
        }
        .btn-primary {
            @apply bg-blue-600 text-white hover:bg-blue-700;
        }
        .btn-secondary {
            @apply bg-gray-400 text-white hover:bg-gray-500;
        }
        .btn-danger {
            @apply bg-red-500 text-white hover:bg-red-600;
        }
        .btn-warning {
            @apply bg-yellow-500 text-white hover:bg-yellow-600;
        }
        .btn-success {
            @apply bg-green-500 text-white hover:bg-green-600;
        }
        .btn-info {
            @apply bg-sky-500 text-white hover:bg-sky-600;
        }

    </style>

</head>

<body class="bg-gray-100 p-4 min-h-screen relative">
    <div class="max-w-5xl mx-auto space-y-4"> <h1 class="text-3xl font-bold text-center text-gray-700">üìã Job / Application Tracker</h1>

        <div id="summary" class="bg-white p-4 rounded-lg shadow-md text-sm text-gray-600">
            </div>

        <div class="flex flex-col sm:flex-row justify-between items-center mt-6 space-y-2 sm:space-y-0">
            <input type="text" id="search" placeholder="üîç Search company, skill, or HR..." class="form-input w-full sm:w-1/2">
            <div class="flex space-x-2">
                <button id="cardViewBtn" class="btn btn-primary active-btn">Card View</button>
                <button id="tableViewBtn" class="btn btn-primary">Table View</button>
            </div>
        </div>
        <div class="my-4 p-3 bg-white rounded-lg shadow-md">
            <h2 class="text-lg font-semibold text-gray-700 mb-2">üîÅ Firebase Sync for <code>entries</code></h2>
            <div class="flex space-x-2">
                <button onclick="syncToFirebase()" class="btn btn-info">‚òÅÔ∏è Sync to Firebase</button>
                <button onclick="restoreFromFirebase()" class="btn btn-success">‚¨áÔ∏è Restore from Firebase</button>
            </div>
            <div id="status" class="mt-2 text-sm"></div>
        </div>

        <div id="displayArea" class="space-y-4"></div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md space-y-4 shadow-xl">
            <h2 id="modalTitle" class="text-2xl font-bold text-blue-700">‚ûï Add New Application</h2>
            <form id="entryForm" class="space-y-3">
                <input required name="company" placeholder="üè¢ Company Name" class="form-input">
                <input name="hr" placeholder="üë§ HR Name (Optional)" class="form-input">
                <input name="mobile" placeholder="üì± Mobile (Optional)" class="form-input">
                <input name="skill" placeholder="üí° Key Skill/Role" class="form-input">
                <input name="np" placeholder="‚è≥ Notice Period (e.g., 30 days)" class="form-input">
                <textarea name="notes" placeholder="üìù Additional Notes (Optional)" class="form-input h-24"></textarea>
                <div class="flex space-x-2">
                    <button type="submit" class="btn btn-primary w-full">Save</button>
                    <button type="button" onclick="closeModal()" class="btn btn-secondary w-full">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div class="add-btn" onclick="openModal()">+</div>

    <script>
        const entryForm = document.getElementById('entryForm');
        const displayArea = document.getElementById('displayArea');
        const searchInput = document.getElementById('search'); // Renamed for clarity
        const cardViewBtn = document.getElementById('cardViewBtn');
        const tableViewBtn = document.getElementById('tableViewBtn');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const summaryDiv = document.getElementById('summary');

        const linearStages = ["Call Recvd", "Call Schedule", "L1 Clear", "L2 Clear", "Final Disc(HR)", "Offered"];
        let entries = JSON.parse(localStorage.getItem('entries') || '[]');
        let isCardView = true;
        let currentlyEditingOriginalIndex = null; // To track editing

        function saveData() {
            localStorage.setItem('entries', JSON.stringify(entries));
            render();
            updateSummary();
        }

        function initializeNewStage() {
            const initialStageDates = new Array(linearStages.length).fill(null);
            initialStageDates[0] = new Date().toISOString(); // Date for "Call Recvd"
            return {
                lastLinearStageIndex: 0,
                linearStageDates: initialStageDates,
                currentOverallStatus: "Active", // "Active", "On Hold", "Rejected"
                statusReason: "",
                statusSetDate: null
            };
        }

        function advanceStage(originalEntryIndex) {
            const entry = entries[originalEntryIndex];
            if (!entry) return;

            if (entry.stage.currentOverallStatus !== "Active") {
                alert(`Application is currently ${entry.stage.currentOverallStatus}. Cannot advance linearly. You might need to "Resume" it first if it's "On Hold".`);
                return;
            }

            if (entry.stage.lastLinearStageIndex < linearStages.length - 1) {
                entry.stage.lastLinearStageIndex++;
                entry.stage.linearStageDates[entry.stage.lastLinearStageIndex] = new Date().toISOString();

                if (linearStages[entry.stage.lastLinearStageIndex] === "Offered") {
                    alert(`üéâ Congratulations! You received an offer from ${entry.company}! üéâ`);
                    // Optionally, set overall status to "Offered" or similar if desired
                    // entry.stage.currentOverallStatus = "Offered";
                }
            } else if (linearStages[entry.stage.lastLinearStageIndex] === "Offered") {
                 alert(`This application is already in the "Offered" stage.`);
            }
            saveData();
        }

        function setOverallStatus(originalEntryIndex, newStatus) {
            const entry = entries[originalEntryIndex];
            if (!entry) return;

            let reason = "";
            if (newStatus === "On Hold" || newStatus === "Rejected") {
                reason = prompt(`Reason for setting status to "${newStatus}" for ${entry.company} (Optional):`);
            }

            entry.stage.currentOverallStatus = newStatus;
            entry.stage.statusSetDate = new Date().toISOString();
            entry.stage.statusReason = reason || ""; // Store empty string if no reason
            
            if (newStatus === "Active" && entry.stage.currentOverallStatus === "On Hold") { // Coming from Resume
                 entry.stage.statusSetDate = null;
                 entry.stage.statusReason = "";
            }

            saveData();
        }
        
        function resumeApplication(originalEntryIndex) {
            const entry = entries[originalEntryIndex];
            if (!entry || entry.stage.currentOverallStatus !== "On Hold") {
                alert("This application is not 'On Hold'.");
                return;
            }
            setOverallStatus(originalEntryIndex, "Active"); // This will clear reason and date via setOverallStatus logic
        }


        function render() {
            const keyword = searchInput.value.toLowerCase();
            // Filter entries and store original index
            const filteredEntriesWithOriginalIndex = entries.map((entry, index) => ({ entry, originalIndex: index }))
                .filter(({ entry }) =>
                    entry.company.toLowerCase().includes(keyword) ||
                    (entry.hr && entry.hr.toLowerCase().includes(keyword)) ||
                    (entry.skill && entry.skill.toLowerCase().includes(keyword))
                );

            displayArea.innerHTML = '';

            if (filteredEntriesWithOriginalIndex.length === 0) {
                displayArea.innerHTML = `<p class="text-center text-gray-500">No applications found matching your criteria.</p>`;
                return;
            }
            
            if (isCardView) {
                filteredEntriesWithOriginalIndex.forEach(({ entry: e, originalIndex }) => {
                    // Ensure stage object exists and is initialized
                    if (!e.stage || !e.stage.linearStageDates) {
                        e.stage = initializeNewStage();
                    }

                    let progressPercent = 0;
                    if (e.stage.currentOverallStatus !== "Rejected" && e.stage.lastLinearStageIndex >= 0) {
                         progressPercent = (e.stage.lastLinearStageIndex + 1) / linearStages.length * 100;
                         if (linearStages[e.stage.lastLinearStageIndex] === "Offered") progressPercent = 100;
                    }


                    let cardClass = "bg-white p-4 rounded-lg shadow-md space-y-3";
                    if (linearStages[e.stage.lastLinearStageIndex] === "Offered" && e.stage.currentOverallStatus !== "Rejected") {
                        cardClass += " offered-card";
                    }

                    let stageDotsHTML = linearStages.map((stageName, idx) => {
                        let tooltipHTML = '';
                        if (e.stage.linearStageDates[idx]) {
                            const formattedDate = new Date(e.stage.linearStageDates[idx]).toLocaleDateString();
                            tooltipHTML = `<div class="stage-date-tooltip">${formattedDate}</div>`;
                        }
                        
                        let stepDotClass = 'progress-step';
                        if (idx <= e.stage.lastLinearStageIndex) {
                            if (e.stage.currentOverallStatus === "Rejected") {
                                // If rejected, active steps before rejection might be normal, or all grayed out
                                // For now, let's make them look normal up to the point of rejection
                                if (idx === e.stage.lastLinearStageIndex) stepDotClass += ' active'; // Keep last linear stage before rejection active-looking
                            } else if (e.stage.currentOverallStatus === "On Hold") {
                                 if (idx === e.stage.lastLinearStageIndex) stepDotClass += ' active hold'; else if (idx < e.stage.lastLinearStageIndex) stepDotClass += ' active';
                            }
                            else {
                                stepDotClass += ' active';
                            }
                        }

                        // Click handler for dots
                        let dotClickHandler = '';
                        if (e.stage.currentOverallStatus === 'Active') {
                            // Allow clicking current or next uncompleted stage
                            if (idx === e.stage.lastLinearStageIndex || idx === e.stage.lastLinearStageIndex + 1 ) {
                                dotClickHandler = `onclick="advanceStage(${originalIndex})"`;
                            } else {
                                dotClickHandler = `style="cursor:not-allowed;"`; // Prevent jumping stages
                            }
                        } else if (e.stage.currentOverallStatus === 'On Hold' && idx === e.stage.lastLinearStageIndex +1){
                             dotClickHandler = `onclick="alert('Resume application first to advance.')" style="cursor:help;"`;
                        }
                        else {
                            dotClickHandler = `style="cursor:not-allowed;"`; // Not active, or rejected
                        }
                         if (idx > e.stage.lastLinearStageIndex + 1 && e.stage.currentOverallStatus === 'Active') {
                            dotClickHandler = `style="cursor:not-allowed;"`; // Don't allow jumping way ahead
                        }


                        return `
                            <div class="flex flex-col items-center">
                                <div class="${stepDotClass}" ${dotClickHandler}>
                                    ${idx + 1}
                                    ${tooltipHTML}
                                </div>
                                <div class="progress-label">${stageName}</div>
                            </div>`;
                    }).join('');
                    
                    const overallStatusColor = e.stage.currentOverallStatus === 'Rejected' ? 'text-red-600' :
                                           e.stage.currentOverallStatus === 'On Hold' ? 'text-yellow-600' :
                                           (linearStages[e.stage.lastLinearStageIndex] === "Offered" ? 'text-green-600' : 'text-blue-600');


                    displayArea.innerHTML += `
                      <div class="${cardClass}">
                        <h2 class="font-bold ${overallStatusColor} text-xl">${e.company}</h2>
                        <div><strong>Status:</strong> <span class="font-semibold ${overallStatusColor}">${e.stage.currentOverallStatus}</span>
                            ${e.stage.statusReason ? ` <span class="text-sm text-gray-500">(${e.stage.statusReason})</span>` : ''}
                            ${e.stage.statusSetDate && e.stage.currentOverallStatus !== 'Active' ? ` <span class="text-xs text-gray-400">- ${new Date(e.stage.statusSetDate).toLocaleDateString()}</span>` : ''}
                        </div>
                        ${e.hr ? `<div>üë§ <strong>HR:</strong> ${e.hr}</div>` : ''}
                        ${e.mobile ? `<div>üì± <strong>Mobile:</strong> ${e.mobile} <button class="copy-btn" onclick="copyToClipboard('${e.mobile}')">Copy</button></div>` : ''}
                        ${e.skill ? `<div>üí° <strong>Skill/Role:</strong> ${e.skill}</div>` : ''}
                        ${e.np ? `<div>‚è≥ <strong>NP:</strong> ${e.np}</div>` : ''}
                        ${e.notes ? `<div class="text-sm text-gray-600">üìù <strong>Notes:</strong> ${e.notes.replace(/\n/g, '<br>')}</div>` : ''}

                        <div class="progress-container mt-3 mb-3">
                          <div class="progress-line"></div>
                          <div class="progress-fill" style="width:${progressPercent}%"></div>
                          ${stageDotsHTML}
                        </div>

                        <div class="action-buttons-grid mt-3 border-t pt-3">
                          <button onclick="setOverallStatus(${originalIndex}, 'On Hold')" class="btn btn-warning text-xs">Hold</button>
                          <button onclick="setOverallStatus(${originalIndex}, 'Rejected')" class="btn btn-danger text-xs">Reject</button>
                          ${e.stage.currentOverallStatus === 'On Hold' ? `<button onclick="resumeApplication(${originalIndex})" class="btn btn-success text-xs">Resume</button>` : ''}
                          <button onclick="editEntry(${originalIndex})" class="btn btn-info text-xs">Edit Details</button>
                          <button onclick="deleteEntry(${originalIndex})" class="btn btn-secondary text-xs">Delete Entry</button>
                        </div>
                      </div>`;
                });
            } else { // Table View
                let table = `<div class="overflow-x-auto bg-white rounded-lg shadow-md"><table class="w-full text-sm">
                    <thead class="bg-gray-200 text-gray-600 uppercase"><tr>
                      <th class="p-3 text-left">Company</th><th class="p-3 text-left">Overall Status</th><th class="p-3 text-left">Current Linear Stage</th><th class="p-3 text-left">HR</th><th class="p-3 text-left">Skill/Role</th><th class="p-3 text-left">Actions</th>
                    </tr></thead><tbody class="text-gray-700">`;
                filteredEntriesWithOriginalIndex.forEach(({ entry: e, originalIndex }) => {
                    if (!e.stage || !e.stage.linearStageDates) {
                        e.stage = initializeNewStage();
                    }
                    let rowClass = "border-t border-gray-200 hover:bg-gray-50";
                    if (linearStages[e.stage.lastLinearStageIndex] === "Offered" && e.stage.currentOverallStatus !== "Rejected") {
                        rowClass += " offered-row";
                    }
                     const overallStatusColor = e.stage.currentOverallStatus === 'Rejected' ? 'text-red-600' :
                                           e.stage.currentOverallStatus === 'On Hold' ? 'text-yellow-600' :
                                           (linearStages[e.stage.lastLinearStageIndex] === "Offered" ? 'text-green-600' : 'text-blue-600');


                    const currentLinearStageName = linearStages[e.stage.lastLinearStageIndex] || 'N/A';
                    const linearStageDate = e.stage.linearStageDates[e.stage.lastLinearStageIndex] ? new Date(e.stage.linearStageDates[e.stage.lastLinearStageIndex]).toLocaleDateString() : 'N/A';

                    table += `<tr class="${rowClass}">
                      <td class="p-3 font-semibold">${e.company}</td>
                      <td class="p-3"><span class="font-semibold ${overallStatusColor}">${e.stage.currentOverallStatus}</span> ${e.stage.statusReason ? `<span class="text-xs text-gray-500">(${e.stage.statusReason})</span>`:""}</td>
                      <td class="p-3">${currentLinearStageName} <span class="text-xs text-gray-400">(${linearStageDate})</span></td>
                      <td class="p-3">${e.hr || '-'}</td>
                      <td class="p-3">${e.skill || '-'}</td>
                      <td class="p-3 whitespace-nowrap action-buttons-grid">
                        <button onclick="setOverallStatus(${originalIndex}, 'On Hold')" class="btn btn-warning btn-xs">Hold</button>
                        <button onclick="setOverallStatus(${originalIndex}, 'Rejected')" class="btn btn-danger btn-xs">Reject</button>
                        ${e.stage.currentOverallStatus === 'On Hold' ? `<button onclick="resumeApplication(${originalIndex})" class="btn btn-success btn-xs">Resume</button>` : ''}
                        <button onclick="editEntry(${originalIndex})" class="btn btn-info btn-xs">Edit</button>
                        <button onclick="deleteEntry(${originalIndex})" class="btn btn-secondary btn-xs">Del</button>
                      </td></tr>`;
                });
                table += '</tbody></table></div>';
                displayArea.innerHTML = table;
            }
        }

        function editEntry(originalIndex) {
            const entryToEdit = entries[originalIndex];
            if (!entryToEdit) return;

            currentlyEditingOriginalIndex = originalIndex;
            modalTitle.textContent = `‚úèÔ∏è Edit Application: ${entryToEdit.company}`;
            openModal();
            entryForm.company.value = entryToEdit.company;
            entryForm.hr.value = entryToEdit.hr || '';
            entryForm.mobile.value = entryToEdit.mobile || '';
            entryForm.skill.value = entryToEdit.skill || '';
            entryForm.np.value = entryToEdit.np || '';
            entryForm.notes.value = entryToEdit.notes || '';
        }

        function deleteEntry(originalIndex) {
            const entryToDelete = entries[originalIndex];
            if (confirm(`Are you sure you want to delete the application for ${entryToDelete.company}?`)) {
                entries.splice(originalIndex, 1);
                saveData();
            }
        }

        function openModal() {
            if(currentlyEditingOriginalIndex === null) { // Only reset title if it's for a new entry
                 modalTitle.textContent = '‚ûï Add New Application';
            }
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.add('hidden');
            entryForm.reset();
            currentlyEditingOriginalIndex = null; // Reset editing state
            modalTitle.textContent = '‚ûï Add New Application'; // Reset title
        }

        entryForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = {
                company: entryForm.company.value.trim(),
                hr: entryForm.hr.value.trim(),
                mobile: entryForm.mobile.value.trim(),
                skill: entryForm.skill.value.trim(),
                np: entryForm.np.value.trim(),
                notes: entryForm.notes.value.trim()
            };

            if (!formData.company) {
                alert("Company name is required.");
                return;
            }

            if (currentlyEditingOriginalIndex !== null) {
                const entryToUpdate = entries[currentlyEditingOriginalIndex];
                Object.assign(entryToUpdate, formData); // Update fields, stage remains
            } else {
                const newEntry = {
                    ...formData,
                    stage: initializeNewStage()
                };
                entries.push(newEntry);
            }
            saveData();
            closeModal();
        });

        searchInput.addEventListener('input', render);

        cardViewBtn.addEventListener('click', () => {
            isCardView = true;
            render();
            cardViewBtn.classList.add('active-btn');
            tableViewBtn.classList.remove('active-btn');
            cardViewBtn.classList.add('btn-primary'); // Ensure it keeps primary style
            tableViewBtn.classList.remove('btn-primary'); 
            tableViewBtn.classList.add('btn-secondary'); // Make inactive button look secondary
        });

        tableViewBtn.addEventListener('click', () => {
            isCardView = false;
            render();
            tableViewBtn.classList.add('active-btn');
            cardViewBtn.classList.remove('active-btn');
            tableViewBtn.classList.add('btn-primary');
            cardViewBtn.classList.remove('btn-primary');
            cardViewBtn.classList.add('btn-secondary');
        });
        
        function updateSummary() {
            const totalApplications = entries.length;
            const offeredCount = entries.filter(e => linearStages[e.stage.lastLinearStageIndex] === "Offered" && e.stage.currentOverallStatus !== "Rejected").length;
            const onHoldCount = entries.filter(e => e.stage.currentOverallStatus === "On Hold").length;
            const rejectedCount = entries.filter(e => e.stage.currentOverallStatus === "Rejected").length;
            const activeCount = entries.filter(e => e.stage.currentOverallStatus === "Active" && linearStages[e.stage.lastLinearStageIndex] !== "Offered").length;


            summaryDiv.innerHTML = `
              <span class="mr-3"><strong>Total:</strong> ${totalApplications}</span>
              <span class="mr-3 text-blue-600"><strong>Active:</strong> ${activeCount}</span>
              <span class="mr-3 text-green-600"><strong>Offered:</strong> ${offeredCount}</span>
              <span class="mr-3 text-yellow-600"><strong>On Hold:</strong> ${onHoldCount}</span>
              <span class="text-red-600"><strong>Rejected:</strong> ${rejectedCount}</span>
            `;
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text)
                .then(() => alert(`Copied "${text}" to clipboard.`))
                .catch(err => console.error('Could not copy text: ', err));
        }

        // Initial setup
        if (isCardView) {
             cardViewBtn.classList.add('btn-primary');
             tableViewBtn.classList.add('btn-secondary');
        } else {
            tableViewBtn.classList.add('btn-primary');
             cardViewBtn.classList.add('btn-secondary');
        }
        render();
        updateSummary();

    // Firebase SDKs (ensure these are correctly placed and config is yours)
    </script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script>
    // ‚úÖ Your Firebase config ‚Äî make sure to update this with your actual Firebase project config
    const firebaseConfig = {
      apiKey: "AIzaSyDGTNO6ygnAE8QG5Hs-rcPRX3TzqrKQa5w", // Replace with your actual API key
      authDomain: "rprofbdb.firebaseapp.com", // Replace with your actual auth domain
      databaseURL: "https://rprofbdb-default-rtdb.asia-southeast1.firebasedatabase.app", // Replace with your actual database URL
      projectId: "rprofbdb", // Replace with your actual project ID
      storageBucket: "rprofbdb.appspot.com", // Corrected: usually ends with .appspot.com
      messagingSenderId: "452736310737", // Replace with your actual sender ID
      appId: "1:452736310737:web:79c2ec79fda09bde7f14f0", // Replace with your actual App ID
      measurementId: "G-HKEZZQZDW2" // Optional: Replace with your actual Measurement ID
    };

    // Initialize Firebase
    let db;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
        console.log("Firebase initialized successfully.");
    } catch (e) {
        console.error("Firebase initialization failed:", e);
        document.getElementById("status").textContent = "‚ö†Ô∏è Firebase initialization failed. Sync disabled.";
    }


    function syncToFirebase() {
        if (!db) {
            document.getElementById("status").textContent = "‚ö†Ô∏è Firebase not initialized. Cannot sync.";
            return;
        }
        // Ensure entries are up-to-date from localStorage before syncing
        const localEntries = JSON.parse(localStorage.getItem("entries") || "[]");
        if (!Array.isArray(localEntries) || localEntries.length === 0) {
            if (confirm("Local data is empty. Do you want to proceed and potentially clear Firebase data?")) {
                 // Proceed to set empty array to Firebase
            } else {
                document.getElementById("status").textContent = "‚ö†Ô∏è Sync cancelled by user due to empty local data.";
                return;
            }
        }

        db.ref("entries").set(localEntries)
            .then(() => {
            document.getElementById("status").textContent = "‚úÖ Entries synced to Firebase.";
            })
            .catch(error => {
            document.getElementById("status").textContent = "‚ùå Sync failed: " + error.message;
            console.error("Firebase sync error:", error);
            });
    }

    function restoreFromFirebase() {
         if (!db) {
            document.getElementById("status").textContent = "‚ö†Ô∏è Firebase not initialized. Cannot restore.";
            return;
        }
        if (confirm("This will overwrite your local data with data from Firebase. Are you sure?")) {
            db.ref("entries").once("value")
            .then(snapshot => {
                const data = snapshot.val() || [];
                localStorage.setItem("entries", JSON.stringify(data));
                entries = data; // Update the in-memory 'entries' array
                saveData(); // This will re-render and update summary with restored data
                document.getElementById("status").textContent = "‚úÖ Entries restored from Firebase. Page reloaded.";
                // location.reload(); // Optional: reload to reflect data, but saveData() should handle it.
            })
            .catch(error => {
                document.getElementById("status").textContent = "‚ùå Restore failed: " + error.message;
                console.error("Firebase restore error:", error);
            });
        } else {
             document.getElementById("status").textContent = "‚ö†Ô∏è Restore cancelled by user.";
        }
    }
    </script>
</body>
</html>
